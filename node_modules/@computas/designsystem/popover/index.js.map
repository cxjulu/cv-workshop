{
  "version": 3,
  "sources": ["../../components/popover/popover.ts", "../../components/shared/getFocusableElement.ts", "../../components/shared/swipeAway.ts"],
  "sourcesContent": ["import { LitElement, css, html, nothing } from 'lit';\nimport { customElement, property, query } from 'lit/decorators.js';\n\nimport { getFocusableElements } from '../shared/getFocusableElement';\nimport { SwipeAway } from '../shared/swipeAway';\n\n@customElement('cx-popover')\nexport class Popover extends LitElement {\n  private popoverAbortController: AbortController | null = null;\n  private swiper = new SwipeAway(this);\n\n  static styles = [\n    css`\n      .trigger {\n        anchor-name: --trigger;\n        display: inline-flex;\n      }\n\n      header {\n        margin-bottom: var(--cx-spacing-4);\n      }\n\n      h1 {\n        /** From typography */\n        margin: 0;\n        font-family: inherit;\n        font-weight: 600;\n        font-size: 1.125rem;\n        line-height: 1.6rem;\n        color: var(--cx-color-text-primary);\n      }\n\n      [popover] {\n        --translate-curve: ease;\n        --translate-duration: 200ms;\n        --bottom-transition-duration: 200ms;\n        \n        position-anchor: --trigger;\n        box-sizing: border-box;\n        position: absolute;\n        opacity: 0;\n        translate: 0px 6px;\n        inset: unset;\n        margin: var(--cx-spacing-2) 0 0 0;\n        position-area: bottom span-right;\n        position-try: --bottom-left, --top-right, --top-left, --center-right, --center-left;\n        transition:\n          display 200ms allow-discrete,\n          overlay 200ms allow-discrete,\n          opacity 200ms ease,\n          translate var(--translate-duration) var(--translate-curve),\n          bottom var(--bottom-transition-duration) ease;\n        background: var(--cx-color-background-primary);\n        border: 1px solid var(--cx-color-border-primary);\n        border-radius: var(--cx-radius-medium);\n        max-height: 500px;\n        padding: var(--cx-spacing-6) var(--cx-spacing-8);\n\n        &::backdrop {\n          opacity: 0;\n\n          transition:\n            display 300ms allow-discrete,\n            overlay 300ms allow-discrete,\n            opacity 300ms ease;\n        }\n\n        &:popover-open {\n          --translate-curve: var(--ease-spring-3);\n          --translate-duration: 500ms;\n          opacity: 1;\n          translate: 0px;\n\n          &::backdrop {\n            opacity: 1;\n          }\n\n          @starting-style {\n            opacity: 0;\n            translate: 0px -6px;\n\n            &::backdrop {\n              opacity: 0;\n            }\n          }\n        }\n\n        @media (pointer: coarse) {\n          position: fixed;\n          inset: auto 0 0 0;\n          border-bottom-width: 0px;\n          translate: 0px 100%;\n          position-anchor: unset;\n          margin: 0;\n          width: 100vw;\n          border-radius: var(--cx-radius-medium) var(--cx-radius-medium) 0 0;\n          min-height: 200px;\n\n          &::backdrop {\n            background-color: var(--cx-color-background-backdrop);\n          }\n\n          &:popover-open {\n            --translate-curve: var(--ease-out-5);\n\n            @starting-style {\n              opacity: 0.5;\n              translate: 0px 100%;\n            }\n          }\n\n          .drag-handle {\n            display: flex;\n          }\n        }\n\n        &.dragging {\n          --bottom-transition-duration: 0ms;\n        }\n      }\n\n      .drag-handle {\n        display: none;\n        justify-content: center;\n        padding-block: 16px;\n        margin-top: -16px;\n        \n        .pill {\n          height: var(--cx-spacing-1);\n          width: var(--cx-spacing-10);\n          border-radius: var(--cx-radius-pill);\n          background: var(--cx-color-border-soft);\n        }\n      }\n\n      @position-try --bottom-left {\n        position-area: bottom span-left;\n        margin: var(--cx-spacing-2) 0 0 0;\n      }\n\n      @position-try --top-right {\n        position-area: top span-right;\n        margin: 0 0 var(--cx-spacing-2) 0;\n      }\n\n      @position-try --top-left {\n        position-area: top span-left;\n        margin: 0 0 var(--cx-spacing-2) 0;\n      }\n\n      @position-try --center-right {\n        position-area: span-bottom right;\n        margin: 0 0 0 var(--cx-spacing-2);\n      }\n\n      @position-try --center-left {\n        position-area: span-bottom left;\n        margin: 0 var(--cx-spacing-2) 0 0;\n      }\n  `,\n  ];\n\n  @property({ type: String, reflect: true })\n  header = '';\n\n  @property({ type: Boolean, reflect: true })\n  autofocus = false;\n\n  @query('[popover]')\n  private popoverElement!: HTMLDivElement;\n\n  @query('#dialog-content')\n  private dialogContent!: HTMLSlotElement;\n\n  @query('slot[name=\"trigger\"]')\n  private triggerWrapper!: HTMLSlotElement;\n\n  private isOpen = false;\n\n  private onTriggerClick() {\n    if (this.isOpen) {\n      this.popoverElement.hidePopover();\n    } else {\n      this.popoverElement.showPopover();\n    }\n  }\n\n  private popoverToggle(event: ToggleEvent) {\n    if (event.newState === 'open') {\n      this.popoverAbortController = new AbortController();\n      this.isOpen = true;\n      this.dispatchEvent(new CustomEvent('open', { bubbles: true, composed: true }));\n\n      if (this.autofocus) {\n        this.focusFirstElementInPopover();\n      }\n\n      this.listenForCloseClicks();\n      this.swiper.startSwipeAwayListener(\n        this.popoverElement,\n        () => {\n          this.popoverElement.hidePopover();\n        },\n        { signal: this.popoverAbortController.signal },\n      );\n    } else {\n      this.popoverAbortController?.abort();\n      (this.triggerWrapper.assignedElements()[0] as HTMLElement).focus();\n      this.isOpen = false;\n      this.dispatchEvent(new CustomEvent('close', { bubbles: true, composed: true }));\n    }\n  }\n\n  private focusFirstElementInPopover() {\n    const focusableElements = getFocusableElements(this.dialogContent);\n    if (focusableElements.length) {\n      (focusableElements.at(0) as HTMLElement).focus();\n    }\n  }\n\n  private listenForCloseClicks() {\n    const closeTriggers = this.dialogContent\n      .assignedElements({ flatten: true })\n      .flatMap((child) => Array.from(child.querySelectorAll('[data-cx-popover-close]')));\n\n    closeTriggers.forEach((element) => {\n      element.addEventListener('click', () => this.popoverElement.hidePopover(), {\n        signal: this.popoverAbortController?.signal,\n      });\n    });\n  }\n\n  private onTouchMove(event: TouchEvent) {\n    event.preventDefault();\n  }\n\n  render() {\n    const header = this.header\n      ? html`\n      <header>\n        <h1>${this.header}</h1>\n      </header>`\n      : nothing;\n\n    return html`\n      <slot class=\"trigger\" name=\"trigger\" @click=${this.onTriggerClick}></slot>\n\n      <div role=\"dialog\" popover @toggle=${this.popoverToggle} @touchmove=${this.onTouchMove}>\n        <div class=\"drag-handle\" data-drag-handle>\n          <div class=\"pill\"></div>\n        </div>\n\n        ${header}\n        <slot id=\"dialog-content\"></slot>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'cx-popover': Popover;\n  }\n}\n", "const focusableItemMatcher =\n  'a[href], button, input, textarea, select, details, [tabindex]:not([tabindex=\"-1\"])';\n\nexport const getFocusableElements = (slot: HTMLSlotElement) => {\n  const focusableElements: Element[] = [\n    ...slot.assignedElements().filter((slotChild) => slotChild.matches(focusableItemMatcher)),\n    ...slot.assignedElements().flatMap((slotChild) => [...slotChild.querySelectorAll(focusableItemMatcher)]),\n  ];\n\n  return focusableElements.filter(\n    (element) => !element.hasAttribute('disabled') && !element.hasAttribute('aria-hidden'),\n  );\n};\n", "import type { ReactiveController, ReactiveControllerHost } from 'lit';\n\ntype SwipeState = {\n  yPos: number;\n  time: number;\n};\n\ntype Options = {\n  signal: AbortSignal;\n};\n\n/**\n * Gives support for swiping an element off the screen.\n * To start the swipe listener, call the `startSwipeAwayListener`\n * and provide the element you wish to observe. If you want a specific\n * element within the element to function as the drag handle, decorate\n * it with a `[data-drag-handle]` attribute.\n */\nexport class SwipeAway implements ReactiveController {\n  private draggedElement: HTMLElement | null = null;\n\n  private abortController: AbortController | null = null;\n  private startYPos: number | null = null;\n  private prevEvent: SwipeState | null = null;\n  private velocity = 0;\n\n  private callbackFn: (() => void) | null = null;\n\n  constructor(private host: ReactiveControllerHost) {\n    this.host.addController(this);\n  }\n\n  hostDisconnected(): void {\n    this.abortController?.abort();\n  }\n\n  startSwipeAwayListener(el: HTMLElement, callbackFn: typeof this.callbackFn, opts?: Partial<Options>) {\n    this.abortController = new AbortController();\n    this.callbackFn = callbackFn;\n    this.draggedElement = el;\n\n    /** If an external abort signal is provided, abort the event listeners either when that signal emits, or if our internal signal emits */\n    const abortSignal = opts?.signal\n      ? AbortSignal.any([opts.signal, this.abortController.signal])\n      : this.abortController.signal;\n\n    /** Use either the element with the attribute [data-drag-handle], or the element itself */\n    const dragHandle = el.querySelector<HTMLElement>('[data-drag-handle]') ?? el;\n    dragHandle.addEventListener('touchmove', (event) => this.onMouseMove(event), { signal: abortSignal });\n    dragHandle.addEventListener('touchend', () => this.onMouseUp(), { signal: abortSignal });\n  }\n\n  private onMouseMove(event: TouchEvent) {\n    /** Prevent default, to prevent swipe event to result in scrolling the background */\n    event.preventDefault();\n\n    const time = Date.now();\n    const y = event.touches[0].screenY;\n    this.velocity = this.prevEvent !== null ? (y - this.prevEvent.yPos) / (this.prevEvent.time - time) : 0;\n\n    if (this.startYPos === null) {\n      this.startYPos = y;\n      this.draggedElement?.classList.add('dragging');\n    }\n\n    this.prevEvent = {\n      yPos: y,\n      time: time,\n    };\n\n    if (this.draggedElement) {\n      this.draggedElement.style.bottom = `${Math.min(0, this.startYPos - y)}px`;\n    }\n  }\n\n  private onMouseUp() {\n    this.startYPos = null;\n\n    if (this.draggedElement) {\n      this.draggedElement.classList.remove('dragging');\n      this.draggedElement.style.bottom = '0px';\n    }\n\n    if (this.velocity < -0.1) {\n      this.abortController?.abort();\n      this.callbackFn?.();\n    }\n\n    this.velocity = 0;\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
